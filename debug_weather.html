<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Debug Weather</title>
    <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        async function init() {
            // Fetch timestamp
            let ts = Math.floor(Date.now() / 1000) - 1000;
            try {
                const res = await fetch('https://api.rainviewer.com/public/weather-maps.json');
                const data = await res.json();
                if (data.radar && data.radar.past) {
                    ts = data.radar.past[data.radar.past.length - 1].time;
                    console.log('Got timestamp:', ts);
                }
            } catch (e) {
                console.error('Fetch failed', e);
            }

            const map = new maplibregl.Map({
                container: 'map',
                style: {
                    version: 8,
                    sources: {
                        'osm': {
                            type: 'raster',
                            tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                            tileSize: 256
                        },
                        'rain': {
                            type: 'raster',
                            tiles: [`https://tile.rainviewer.com/${ts}/256/{z}/{x}/{y}/2/1_1.png`],
                            tileSize: 256
                        }
                    },
                    layers: [
                        {
                            id: 'osm',
                            type: 'raster',
                            source: 'osm'
                        },
                        {
                            id: 'rain',
                            type: 'raster',
                            source: 'rain',
                            paint: { 'raster-opacity': 0.8 }
                        }
                    ]
                },
                center: [10, 50],
                zoom: 4
            });
        }
        init();
    </script>
</body>

</html>